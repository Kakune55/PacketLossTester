<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网络丢包率测试</title>
    <link rel="stylesheet" href="/styles/main.css">
</head>
<body>
    <main class="card">
        <header class="header">
            <h1>网络丢包率测试</h1>
            <a class="back-link" href="/speedtest.html">网络测速</a>
        </header>
        <section class="form-grid">
            <div class="form-group">
                <label for="frequency">每秒发送的数据包数量</label>
                <div class="range-container">
                    <input type="range" id="frequency" min="1" max="256" value="32" oninput="syncRangeToInput('frequency')">
                    <input type="number" class="range-input" id="frequency-input" min="1" max="256" value="32" oninput="syncInputToRange('frequency')">
                </div>
            </div>
            <div class="form-group">
                <label for="size">数据包大小 (字节)</label>
                <div class="range-container">
                    <input type="range" id="size" min="1" max="16384" value="1024" oninput="syncRangeToInput('size')">
                    <input type="number" class="range-input" id="size-input" min="1" max="16384" value="1024" oninput="syncInputToRange('size')">
                </div>
            </div>
            <div class="form-group">
                <label for="duration">持续时间 (秒)</label>
                <div class="range-container">
                    <input type="range" id="duration" min="1" max="300" value="10" oninput="syncRangeToInput('duration')">
                    <input type="number" class="range-input" id="duration-input" min="1" max="300" value="10" oninput="syncInputToRange('duration')">
                </div>
            </div>
        </section>
        <section class="interactive-layout">
            <div id="stats">
                <div>发送的数据包数量: <span id="sent-packets">0</span></div>
                <div>接收的数据包数量: <span id="received-packets">0</span></div>
                <div>丢包率: <span id="packet-loss-rate">0%</span></div>
                <div class="stats-divider"></div>
                <div>平均延迟: <span id="avg-latency">-</span> ms</div>
                <div>最小延迟: <span id="min-latency">-</span> ms</div>
                <div>最大延迟: <span id="max-latency">-</span> ms</div>
                <div>前10%延迟: <span id="p90-latency">-</span> ms</div>
                <div>抖动(Jitter): <span id="jitter">-</span> ms</div>
            </div>
            <div class="control-container">
                <div class="checkbox-group">
                    <input type="checkbox" id="stress-mode" onchange="toggleStressMode()">
                    <label for="stress-mode">压测模式（无限期测试，保留10秒滚动数据）</label>
                </div>
                <div class="form-group">
                    <label for="preset">测试预设</label>
                    <select id="preset" onchange="applyPreset()">
                        <!-- 从 presets.json 动态加载 -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="testNode">测试节点</label>
                    <select id="testNode">
                        <!-- Populate with nodes -->
                    </select>
                </div>
                <div class="control-stack">
                    <div class="button-group">
                        <button id="start-btn">开始测试</button>
                        <button id="stop-btn">停止测试</button>
                    </div>
                    <div id="status" class="status-banner status-banner--compact">状态: 就绪</div>
                </div>
            </div>
        </section>
        <section id="chart-container">
            <canvas id="chart" width="600" height="300"></canvas>
        </section>
        <footer class="footer">
            <p>PacketLossTester | <a href="https://github.com/Kakune55/PacketLossTester">GitHub</a></p>
        </footer>
    </main>
    <script src="/js/chart.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>